<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Product Catalog</title>
<style>
:root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--glass:rgba(255,255,255,0.08)}
html,body{
  height:100%;margin:0;
  font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,Arial;
  color:#e6eef6;font-size:13px;
  background:linear-gradient(180deg,#021124 0%,#071326 100%);
}
.wrap{max-width:100%;margin:0 auto;padding:10px}
h1{text-align:center;font-size:1rem;margin:0 0 8px}
.card{background:var(--card);border-radius:10px;padding:10px;box-shadow:0 3px 12px rgba(0,0,0,0.5);}
.controls{display:flex;flex-direction:column;gap:8px}
.btn{
  background:linear-gradient(90deg,var(--accent),#7dd3fc);
  border:none;padding:8px;border-radius:8px;
  color:#021124;font-weight:600;cursor:pointer;font-size:0.9rem;text-align:center
}
input[type="file"]{display:none}
.search{position:relative}
.search input{
  width:100%;padding:12px 10px;border-radius:10px;
  border:1px solid rgba(255,255,255,0.1);
  background:var(--glass);color:inherit;font-size:1rem;
}
.meta{margin-top:8px;color:var(--muted);font-size:0.8rem;text-align:center}
.table-wrap{margin-top:10px}
table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:0.8rem}
th,td{
  padding:6px 5px;text-align:left;
  border-bottom:1px solid rgba(255,255,255,0.05);
  word-wrap:break-word;white-space:normal;
}
th{
  color:var(--muted);font-weight:600;
  position:sticky;top:0;background:var(--card);z-index:1
}
.tag{display:inline-block;padding:3px 6px;border-radius:999px;background:rgba(255,255,255,0.1);font-size:0.7rem;color:var(--muted)}
.footer{margin:10px 0 0;text-align:center;font-size:0.7rem;color:var(--muted)}
.zero-qty{color:red;font-weight:600;}
mark{background:rgba(6,182,212,0.3);color:#fff;border-radius:2px;padding:0 1px}
</style>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
<div class="wrap">
  <h1>Product Catalog</h1>
  <div class="card">
    <div class="controls">
      <label id="upload-label" class="btn">Upload File
        <input id="file-input" type="file" accept=".xlsx,.xls,.csv"/>
      </label>
      <button id="upload-again" class="btn" style="display:none">Upload Again</button>
      <div class="search">
        <input id="search-box" placeholder="ðŸ” Search products..." />
      </div>
    </div>
    <div class="meta" id="file-meta">No file loaded.</div>
    <div class="table-wrap card" style="margin-top:10px;">
      <span class="tag" id="rows-count">0 rows</span>
      <div style="max-height:360px;margin-top:6px;">
        <table id="data-table"><thead></thead><tbody></tbody></table>
      </div>
    </div>
  </div>
  <div class="footer">Mobile Catalog App</div>
</div>

<script>
let rawData=[], headers=[], qtyColumn='Available physical';
const fileInput=document.getElementById('file-input');
const uploadLabel=document.getElementById('upload-label');
const uploadAgain=document.getElementById('upload-again');
const searchBox=document.getElementById('search-box');
const fileMeta=document.getElementById('file-meta');
const rowsCount=document.getElementById('rows-count');
const dataTable=document.getElementById('data-table');

fileInput.addEventListener('change', async ev=>{
  const f=ev.target.files[0]; if(!f) return;
  const buffer=await f.arrayBuffer();
  const workbook=XLSX.read(buffer,{type:'array'});
  const sheetName=workbook.SheetNames[0];
  const worksheet=workbook.Sheets[sheetName];
  const json=XLSX.utils.sheet_to_json(worksheet,{defval:'',header:1});
  if(json.length<=1){ fileMeta.textContent='No rows found'; return; }

  headers=json[0];
  rawData=json.slice(1).map(row=>Object.fromEntries(headers.map((h,i)=>[h,row[i]])));
  fileMeta.textContent=`${f.name} â€” ${rawData.length} rows`;
  rowsCount.textContent=`${rawData.length} rows`;
  renderTable([]); // start empty
  uploadLabel.style.display='none'; uploadAgain.style.display='block';
});

uploadAgain.addEventListener('click',()=>{
  fileInput.value=''; uploadLabel.style.display='block'; uploadAgain.style.display='none';
  fileMeta.textContent='No file loaded.'; rowsCount.textContent='0 rows';
  dataTable.querySelector('thead').innerHTML=''; dataTable.querySelector('tbody').innerHTML='';
  rawData=[]; headers=[];
});

searchBox.addEventListener('input',debounce(()=>{
  const q=searchBox.value.trim().toLowerCase();
  if(!q){ renderTable([]); return; }

  // Filter: only rows where column B contains typed letters in order
  let results=rawData.filter(r=>{
    const val=String(r[headers[1]]||'').toLowerCase();
    return val.includes(q);
  });

  // Sort: first by match position, then by quantity (desc)
  results.sort((a,b)=>{
    const aVal=String(a[headers[1]]||'').toLowerCase();
    const bVal=String(b[headers[1]]||'').toLowerCase();
    const aIndex=aVal.indexOf(q);
    const bIndex=bVal.indexOf(q);
    if(aIndex!==bIndex) return aIndex-bIndex; // closer to start = higher
    return parseFloat(b[qtyColumn]||0)-parseFloat(a[qtyColumn]||0);
  });

  renderTable(results.slice(0,50),q); // limit to 50
}));

function renderTable(rows,q=''){
  const thead=dataTable.querySelector('thead'), tbody=dataTable.querySelector('tbody');
  thead.innerHTML=''; tbody.innerHTML='';
  if(!rows||rows.length===0){ thead.innerHTML='<tr><th>No results</th></tr>'; rowsCount.textContent='0 rows'; return; }

  // Only A,B,C,D
  const cols=headers.slice(0,4);
  thead.innerHTML='<tr>'+cols.map(c=>`<th>${escapeHtml(c)}</th>`).join('')+'</tr>';
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=cols.map(c=>{
      let val=String(r[c]||'');
      if(c===qtyColumn && (val===''||parseFloat(val)===0)) return `<td class="zero-qty">0</td>`;
      if(q && c===headers[1]) val=highlightMatch(val,q);
      return `<td>${val}</td>`;
    }).join('');
    tbody.appendChild(tr);
  });
  rowsCount.textContent=`${rows.length} rows`;
}

function highlightMatch(text,query){
  if(!query) return escapeHtml(text);
  const re=new RegExp(`(${query})`,'gi');
  return escapeHtml(text).replace(re,'<mark>$1</mark>');
}
function escapeHtml(s){ return s.replace(/[&<>"]|'/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m])) }
function debounce(fn,delay=200){let t; return(...args)=>{clearTimeout(t); t=setTimeout(()=>fn(...args),delay);};}
</script>
</body>
</html>
